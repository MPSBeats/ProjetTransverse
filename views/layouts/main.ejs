<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- SEO -->
  <title>
    <%= typeof metaTitle !=='undefined' && metaTitle ? metaTitle
      : "L'InviThe Gourmand - Salon de The, Macarons, Paris 14e" %>
  </title>
  <meta name="description"
    content="<%= typeof metaDescription !== 'undefined' && metaDescription ? metaDescription : 'Commandez en ligne nos thes bio, macarons artisanaux, patisseries maison. Salon de the Paris 14e.' %>">
  <% if (typeof canonicalUrl !=='undefined' && canonicalUrl) { %>
    <link rel="canonical" href="<%= canonicalUrl %>">
    <% } %>

      <!-- Open Graph -->
      <meta property="og:type" content="website">
      <meta property="og:title"
        content="<%= typeof metaTitle !== 'undefined' && metaTitle ? metaTitle : 'InviThe Gourmand' %>">
      <meta property="og:description"
        content="<%= typeof metaDescription !== 'undefined' && metaDescription ? metaDescription : '' %>">
      <meta property="og:image"
        content="<%= typeof metaImage !== 'undefined' && metaImage ? metaImage : '/images/og-default.jpg' %>">
      <meta property="og:locale" content="fr_FR">
      <meta property="og:site_name" content="InviThe Gourmand">

      <!-- JSON-LD Structured Data -->
      <% if (typeof jsonLd !=='undefined' && jsonLd) { %>
        <script type="application/ld+json"><%- JSON.stringify(jsonLd) %></script>
        <% } %>

          <!-- Preload Fonts -->
          <link rel="preconnect" href="https://fonts.googleapis.com">
          <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
          <link
            href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400&display=swap"
            rel="stylesheet">

          <!-- CSS -->
          <link rel="stylesheet" href="/css/style.css">

          <!-- AOS Animation Library -->
          <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css">

          <!-- Favicon -->
          <link rel="icon" type="image/svg+xml" href="/images/favicon.svg">
</head>

<body class="bg-creme text-brun font-body antialiased">

  <%- include('../partials/header') %>

    <!-- Contenu principal -->
    <main id="main-content" class="min-h-screen">
      <%- body %>
    </main>

    <%- include('../partials/footer') %>

      <!-- Cart Drawer -->
      <div x-data x-show="$store.cart.drawerOpen" x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0" class="fixed inset-0 z-50" style="display: none;"
        @keydown.escape.window="$store.cart.drawerOpen = false">

        <!-- Overlay -->
        <div class="absolute inset-0 bg-noir-cafe/40 backdrop-blur-sm" @click="$store.cart.drawerOpen = false"></div>

        <!-- Drawer -->
        <div x-show="$store.cart.drawerOpen" x-transition:enter="transition ease-out duration-300 transform"
          x-transition:enter-start="translate-x-full" x-transition:enter-end="translate-x-0"
          x-transition:leave="transition ease-in duration-200 transform" x-transition:leave-start="translate-x-0"
          x-transition:leave-end="translate-x-full"
          class="absolute right-0 top-0 h-full w-full max-w-md bg-blanc-casse shadow-warm-lg overflow-y-auto">

          <div class="p-6">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
              <h2 class="font-display text-2xl text-noir-cafe">Votre Panier</h2>
              <button @click="$store.cart.drawerOpen = false" class="p-2 hover:bg-creme rounded-full transition-colors"
                aria-label="Fermer le panier">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>

            <!-- Items -->
            <template x-if="$store.cart.items.length === 0">
              <div class="text-center py-12">
                <svg class="w-16 h-16 mx-auto text-terracotta/30 mb-4" fill="none" stroke="currentColor"
                  viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                </svg>
                <p class="text-brun/60 font-accent italic text-lg">Votre panier est vide</p>
                <a href="/boutique"
                  class="inline-block mt-4 px-6 py-2 bg-terracotta text-blanc-casse rounded-gourmand hover:bg-terracotta-dark transition-colors">Decouvrir
                  nos produits</a>
              </div>
            </template>

            <template x-if="$store.cart.items.length > 0">
              <div>
                <template x-for="item in $store.cart.items" :key="item.productId">
                  <div class="flex gap-4 py-4 border-b border-creme">
                    <img :src="item.image" :alt="item.name" class="w-20 h-20 object-cover rounded-gourmand"
                      loading="lazy">
                    <div class="flex-1">
                      <h3 class="font-body font-medium text-sm" x-text="item.name"></h3>
                      <p class="text-terracotta font-medium text-sm mt-1">
                        <span x-text="(item.promoPrice || item.price).toFixed(2) + ' EUR'"></span>
                      </p>
                      <div class="flex items-center gap-2 mt-2">
                        <button @click="$store.cart.updateQuantity(item.productId, item.quantity - 1)"
                          class="w-7 h-7 flex items-center justify-center rounded-full border border-brun/20 hover:bg-creme transition-colors text-sm">-</button>
                        <span class="w-8 text-center text-sm font-medium" x-text="item.quantity"></span>
                        <button @click="$store.cart.updateQuantity(item.productId, item.quantity + 1)"
                          class="w-7 h-7 flex items-center justify-center rounded-full border border-brun/20 hover:bg-creme transition-colors text-sm">+</button>
                        <button @click="$store.cart.removeItem(item.productId)"
                          class="ml-auto text-rose-macaron-dark hover:text-red-600 transition-colors"
                          aria-label="Supprimer">
                          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                          </svg>
                        </button>
                      </div>
                    </div>
                  </div>
                </template>

                <!-- Total -->
                <div class="mt-6 space-y-2">
                  <div class="flex justify-between text-sm">
                    <span>Sous-total</span>
                    <span x-text="$store.cart.subtotal.toFixed(2) + ' EUR'"></span>
                  </div>
                  <template x-if="$store.cart.discount > 0">
                    <div class="flex justify-between text-sm text-vert-the">
                      <span>Reduction</span>
                      <span x-text="'-' + $store.cart.discount.toFixed(2) + ' EUR'"></span>
                    </div>
                  </template>
                  <div class="flex justify-between font-display text-lg text-noir-cafe pt-2 border-t border-creme">
                    <span>Total</span>
                    <span class="text-terracotta" x-text="$store.cart.total.toFixed(2) + ' EUR'"></span>
                  </div>
                </div>

                <!-- CTA -->
                <a href="/panier"
                  class="block w-full mt-6 py-3 bg-terracotta text-blanc-casse text-center rounded-gourmand font-medium hover:bg-terracotta-dark transition-colors shadow-warm">
                  Voir le panier complet
                </a>
                <a href="/checkout"
                  class="block w-full mt-3 py-3 bg-noir-cafe text-creme text-center rounded-gourmand font-medium hover:bg-brun transition-colors">
                  Passer commande
                </a>
              </div>
            </template>
          </div>
        </div>
      </div>

      <!-- Toast Notification -->
      <div x-data x-show="$store.cart.toast" x-transition:enter="transition ease-out duration-300 transform"
        x-transition:enter-start="translate-y-full opacity-0" x-transition:enter-end="translate-y-0 opacity-100"
        x-transition:leave="transition ease-in duration-200 transform"
        x-transition:leave-start="translate-y-0 opacity-100" x-transition:leave-end="translate-y-full opacity-0"
        class="fixed bottom-6 right-6 z-50 bg-noir-cafe text-creme px-6 py-3 rounded-gourmand shadow-warm-lg flex items-center gap-3"
        style="display: none;">
        <svg class="w-5 h-5 text-vert-the animate-pulse-check" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        <span x-text="$store.cart.toastMessage" class="text-sm"></span>
      </div>

      <!-- Cookie Consent -->
      <%- include('../partials/cookie-consent') %>

        <!-- Scripts -->
        <script src="/js/cart.js" defer></script>
        <script src="https://unpkg.com/alpinejs@3.14.3/dist/cdn.min.js" defer></script>
        <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
        <script src="/js/app.js"></script>
</body>

</html>